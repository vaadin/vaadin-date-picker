<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-styles/shadow.html">
<link rel="import" href="../paper-styles/typography.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="vaadin-month-calendar.html">
<link rel="import" href="vaadin-infinite-scroller.html">

<dom-module id="vaadin-date-picker-overlay">
  <template>
    <style>
      :host {
        display: flex;
        flex-direction: column;
        height: 100%;
        background: #fff;
        font: inherit;
        @apply(--paper-font-common-base);
        @apply(--shadow-elevation-2dp);
      }

      #toolbar {
        padding: 0.3em;
        background: #eee;
        @apply(--shadow-elevation-2dp);
        @apply(--layout-horizontal);
      }

      #scroller {
        height: 100%;
      }

      #yearLabel {
        padding: 0.7em;
      }

      #todayButton {
        color: var(--primary-color, #00B4F0);
      }
    </style>

    <div id="toolbar">
      <div id="yearLabel">[[_yearAfterXMonths(_visibleMonthIndex)]]</div>
      <paper-button id="todayButton" on-tap="_scrollToCurrentMonth">
        <iron-icon icon="event"></iron-icon>
        today
      </paper-button>
    </div>

    <vaadin-infinite-scroller id="scroller" on-scroll="_onListScroll" item-height="250" buffer-size="20">
      <template>
        <vaadin-month-calendar locale="[[locale]]" month="[[_dateAfterXMonths(index)]]" selected-date="{{selectedDate}}"></vaadin-month-calendar>
      </template>
    </vaadin-infinite-scroller>

  </template>
  <script>
    Polymer({
      is: 'vaadin-date-picker-overlay',

      properties: {
        /**
         * The value for this element.
         */
        selectedDate: {
          type: Date,
          notify: true
        },

        /**
         * Locale of this element used for formatting and naming of months and days.
         * Must be a locale supported by [Moment.js](http://momentjs.com/),
         * for example `en-gb`, `fi`, `es`, etc.
         */
        locale: {
          type: String
        },

        _originDate: {
          value: new Date()
        },

        _visibleMonthIndex: Number
      },

      /**
       * Scrolls the list to the given Date.
       */
      scrollToDate: function(date) {
        this.$.scroller.position = this._differenceInMonths(date, this._originDate);
        this.async(this._onListScroll, 1);
      },

      _scrollToCurrentMonth: function() {
        this.scrollToDate(new Date());
      },

      _onListScroll: function() {
        this._visibleMonthIndex = Math.floor(this.$.scroller.position);
      },

      _yearAfterXMonths: function(months) {
        return this._dateAfterXMonths(months).getFullYear();
      },

      _dateAfterXMonths: function(months) {
        var result = new Date(this._originDate);
        result.setMonth(parseInt(months) + this._originDate.getMonth());
        return result;
      },

      _differenceInMonths: function(date1, date2) {
        var months = (date1.getFullYear() - date2.getFullYear()) * 12;
        return months - date2.getMonth() + date1.getMonth();
      }

    });
  </script>
</dom-module>
